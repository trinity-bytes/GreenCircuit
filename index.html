<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GreenCircuit - Optimización de Rutas de Recolección</title>
    <meta
      name="description"
      content="Optimización de rutas de recolección de residuos urbanos usando el Problema del Agente Viajero (TSP)"
    />

    <link rel="icon" type="image/png" href="assets/leaf-icon.png" />

    <!-- CSS -->
    <link rel="stylesheet" href="src/styles/main.css" />
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn-uicons.flaticon.com/uicons-solid-rounded/css/uicons-solid-rounded.css"
    />

    <!-- Cytoscape.js desde CDN -->
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  </head>

  <body>
    <!-- CONTENEDOR PRINCIPAL DE LA APP -->
    <div class="app-container">
      <!-- HEADER CON WIZARD INTEGRADO -->
      <header class="app-header">
        <div class="app-logo">
          <span class="app-logo-icon">
            <img
              src="assets/leaf-icon.png"
              alt="GreenCircuit"
              width="44"
              height="44"
            />
          </span>
          <span class="app-logo-text">GreenCircuit</span>
        </div>

        <!-- WIZARD PROGRESS EN HEADER -->
        <div class="wizard-progress-header">
          <div class="wizard-steps">
            <div class="wizard-step active" data-step="1">
              <div class="wizard-step-number">1</div>
              <div class="wizard-step-label">Configuración</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="2">
              <div class="wizard-step-number">2</div>
              <div class="wizard-step-label">Generación</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="3">
              <div class="wizard-step-number">3</div>
              <div class="wizard-step-label">Visualización</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="4">
              <div class="wizard-step-number">4</div>
              <div class="wizard-step-label">Ejecución</div>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-4">
          <a
            href="https://github.com/trinity-bytes/GreenCircuit"
            class="btn btn-ghost btn-sm"
            target="_blank"
            rel="noopener noreferrer"
          >
            <svg
              class="icon"
              aria-hidden="true"
              viewBox="0 0 24 24"
              width="20"
              height="20"
            >
              <path
                fill="currentColor"
                d="M12 2a10 10 0 0 0-3.16 19.48c.5.09.68-.22.68-.48 0-.24-.01-.87-.01-1.71-2.78.6-3.37-1.34-3.37-1.34-.45-1.15-1.11-1.46-1.11-1.46-.9-.62.07-.61.07-.61 1 .07 1.54 1.03 1.54 1.03.89 1.53 2.34 1.09 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.94 0-1.09.39-1.98 1.03-2.68-.1-.25-.45-1.28.1-2.66 0 0 .84-.27 2.75 1.02a9.56 9.56 0 0 1 5 0c1.91-1.29 2.75-1.02 2.75-1.02.55 1.38.2 2.41.1 2.66.64.7 1.03 1.59 1.03 2.68 0 3.84-2.34 4.68-4.57 4.93.36.31.68.92.68 1.86 0 1.34-.01 2.42-.01 2.75 0 .27.18.58.69.48A10 10 0 0 0 12 2"
              />
            </svg>
            <span>Ver código fuente</span>
          </a>
          <a href="landing.html" class="btn btn-outline btn-sm">
            <i class="fi fi-rr-info icon" aria-hidden="true"></i>
            <span>Más información</span>
          </a>
        </div>
      </header>

      <!-- MAIN CONTENT CENTRADO -->
      <main class="app-main app-main--scroll">
        <div class="container-narrow">
          <!-- SECCIÓN 1: CONFIGURACIÓN -->
          <section
            id="config-section"
            class="content-section animate-fade-in-up delay-200"
          >
            <div class="section-header">
              <div>
                <div class="section-heading">
                  <div class="section-step-badge">1</div>
                  <h2 class="section-title">Configuración del Grafo</h2>
                </div>
                <p class="section-subtitle section-subtitle-offset">
                  Define el número de puntos de recolección para optimizar
                </p>
              </div>
            </div>

            <div class="card mt-6">
              <div class="card-body">
                <div class="form-group">
                  <label for="input-n" class="form-label">
                    <strong
                      >¿Cuántos puntos de recolección deseas optimizar?</strong
                    >
                  </label>
                  <div class="flex items-center gap-4">
                    <input
                      type="number"
                      id="input-n"
                      class="form-input form-input--counter"
                      min="4"
                      max="16"
                      value="8"
                      placeholder="Ej: 8"
                    />
                    <span class="text-secondary text-sm"
                      >puntos (entre 4 y 16)</span
                    >
                  </div>
                  <small class="form-helper flex items-start gap-2">
                    <i class="fi fi-rr-bulb icon" aria-hidden="true"></i>
                    <span>
                      <strong>Recomendación:</strong> Comienza con 10 puntos
                      para una ejecución rápida. Valores mayores a 12 pueden
                      tardar varios segundos.
                    </span>
                  </small>
                </div>

                <button id="btn-config" class="btn btn-primary btn-lg w-full">
                  <i class="fi fi-rr-check-circle icon" aria-hidden="true"></i>
                  <span>Continuar</span>
                </button>
              </div>
            </div>

            <div id="config-status" class="mt-4"></div>
          </section>

          <!-- SECCIÓN 2: GENERACIÓN (Inicialmente oculta) -->
          <section id="generation-section" class="content-section hidden">
            <div class="section-header">
              <div>
                <div class="section-heading">
                  <div class="section-step-badge">2</div>
                  <h2 class="section-title">Generación del Grafo</h2>
                </div>
                <p class="section-subtitle section-subtitle-offset">
                  Elige cómo distribuir los puntos en el mapa
                </p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4 mt-6">
              <button id="btn-random" class="card hover-lift">
                <div class="card-emoji">
                  <i class="fi fi-rr-dice" aria-hidden="true"></i>
                </div>
                <h3 class="card-heading">Aleatorio</h3>
                <p class="card-description">
                  Distribución aleatoria con separación mínima
                </p>
              </button>

              <button id="btn-random-circular" class="card hover-lift">
                <div class="card-emoji">
                  <i class="fi fi-rr-circle" aria-hidden="true"></i>
                </div>
                <h3 class="card-heading">Circular</h3>
                <p class="card-description">
                  Puntos distribuidos en un círculo uniforme
                </p>
              </button>

              <button id="btn-random-grid" class="card hover-lift">
                <div class="card-emoji">
                  <i class="fi fi-rr-grid" aria-hidden="true"></i>
                </div>
                <h3 class="card-heading">Grid</h3>
                <p class="card-description">
                  Distribución en cuadrícula regular
                </p>
              </button>
            </div>

            <div id="generation-status" class="mt-4"></div>
          </section>
          <!-- SECCIÓN 3: VISUALIZACIÓN DEL GRAFO -->
          <section id="visualization-section" class="content-section hidden">
            <div class="section-header">
              <div>
                <div class="section-heading">
                  <div class="section-step-badge">3</div>
                  <h2 class="section-title">Visualización del Grafo</h2>
                </div>
                <p class="section-subtitle section-subtitle-offset">
                  Explora y edita el grafo generado
                </p>
              </div>
            </div>

            <div id="graph-info" class="card card-gradient mb-4 hidden">
              <div class="card-body">
                <div id="graph-stats"></div>
              </div>
            </div>

            <div class="graph-wrapper mt-6">
              <div id="graph-container"></div>

              <!-- Toolbar flotante -->
              <div class="floating-toolbar">
                <button
                  id="btn-fit-view"
                  class="btn btn-icon btn-ghost"
                  title="Ajustar vista"
                >
                  <i class="fi fi-rr-search icon" aria-hidden="true"></i>
                </button>
                <button
                  id="btn-reset-view"
                  class="btn btn-icon btn-ghost"
                  title="Resetear vista"
                >
                  <i class="fi fi-rr-rotate-right icon" aria-hidden="true"></i>
                </button>
                <div class="toolbar-divider"></div>
                <button
                  id="btn-toggle-edit"
                  class="btn btn-sm btn-warning"
                  title="Activar modo edición"
                >
                  <i class="fi fi-rr-pencil icon" aria-hidden="true"></i>
                  <span>Editar</span>
                </button>
                <button
                  id="btn-clear-graph"
                  class="btn btn-icon btn-danger hidden"
                  title="Limpiar grafo"
                >
                  <i class="fi fi-rr-trash icon" aria-hidden="true"></i>
                </button>
              </div>
            </div>

            <div
              id="edit-mode-info"
              class="info-box info-box-warning mt-4 hidden"
            >
              <strong>
                <i class="fi fi-rr-pencil icon" aria-hidden="true"></i>
                <span>Modo edición activo</span>
              </strong>
              <ul class="list-relaxed">
                <li>
                  <strong>Click en el canvas</strong> → Agregar un nodo nuevo
                </li>
                <li>
                  <strong>Click derecho en un nodo</strong> → Eliminar nodo
                </li>
                <li>
                  <strong>Click en dos nodos</strong> → Conectar y asignar peso
                </li>
                <li><strong>Click en una arista</strong> → Cambiar su peso</li>
                <li><strong>Límite:</strong> Máximo 16 nodos permitidos</li>
              </ul>
            </div>

            <button
              id="btn-continue-execution"
              class="btn btn-primary btn-lg w-full mt-6 hidden"
            >
              <span>Continuar</span>
              <i class="fi fi-rr-arrow-right icon" aria-hidden="true"></i>
            </button>
          </section>

          <!-- SECCIÓN 4: CONTROLES DE EJECUCIÓN (Inicialmente oculta) -->
          <section id="controls-section" class="content-section hidden">
            <div class="section-header">
              <div>
                <div class="section-heading">
                  <div class="section-step-badge">4</div>
                  <h2 class="section-title">Ejecutar Algoritmo TSP</h2>
                </div>
                <p class="section-subtitle section-subtitle-offset">
                  Configura la velocidad y ejecuta la optimización
                </p>
              </div>
            </div>

            <div class="card mt-6">
              <div class="card-body">
                <label class="form-label mb-4">
                  <strong class="flex items-center gap-2">
                    <i class="fi fi-rr-bolt icon" aria-hidden="true"></i>
                    <span>Velocidad de ejecución</span>
                  </strong>
                </label>

                <div class="speed-options mb-6">
                  <label class="speed-option">
                    <input
                      type="radio"
                      name="speed"
                      value="fast"
                      id="speed-fast"
                      class="input-hidden"
                    />
                    <div class="speed-card" data-speed="fast" id="btn-fast">
                      <div class="speed-icon">
                        <i class="fi fi-rr-bolt icon-lg" aria-hidden="true"></i>
                      </div>
                      <div class="speed-name">Rápido</div>
                      <div class="speed-desc">500ms/paso</div>
                    </div>
                  </label>

                  <label class="speed-option">
                    <input
                      type="radio"
                      name="speed"
                      value="slow"
                      id="speed-slow"
                      checked
                      class="input-hidden"
                    />
                    <div
                      class="speed-card active"
                      data-speed="slow"
                      id="btn-slow"
                    >
                      <div class="speed-icon">
                        <i
                          class="fi fi-rr-hourglass icon-lg"
                          aria-hidden="true"
                        ></i>
                      </div>
                      <div class="speed-name">Lento</div>
                      <div class="speed-desc">1s/paso</div>
                    </div>
                  </label>

                  <label class="speed-option">
                    <input
                      type="radio"
                      name="speed"
                      value="manual"
                      id="speed-manual"
                      class="input-hidden"
                    />
                    <div
                      class="speed-card"
                      data-speed="manual"
                      id="btn-manual-step"
                    >
                      <div class="speed-icon">
                        <i
                          class="fi fi-rr-hand-pointer icon-lg"
                          aria-hidden="true"
                        ></i>
                      </div>
                      <div class="speed-name">Manual</div>
                      <div class="speed-desc">Click/paso</div>
                    </div>
                  </label>
                </div>

                <div class="info-box info-box-warning mb-6">
                  <strong class="flex items-center gap-2">
                    <i
                      class="fi fi-rr-triangle-warning icon"
                      aria-hidden="true"
                    ></i>
                    <span>Recomendación</span>
                  </strong>
                  <span>
                    Para N &gt; 10, usa modo <strong>Lento</strong> o
                    <strong>Manual</strong> para evitar congelamiento.
                  </span>
                </div>

                <div id="manual-controls" class="hidden mb-6">
                  <button id="btn-next-step" class="btn btn-outline w-full">
                    <span>Siguiente paso</span>
                    <i class="fi fi-rr-arrow-right icon" aria-hidden="true"></i>
                  </button>
                </div>

                <button id="btn-execute" class="btn btn-xl w-full">
                  <i class="fi fi-rr-play icon" aria-hidden="true"></i>
                  <span>Ejecutar algoritmo</span>
                </button>
              </div>
            </div>

            <div id="execution-status" class="mt-4"></div>

            <div id="progress-container" class="hidden mt-6">
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
              </div>
              <div id="progress-text" class="progress-text">Progreso: 0%</div>
            </div>
          </section>

          <!-- SECCIÓN 5: LOGS Y RESULTADOS (Inicialmente oculta) -->
          <section id="results-section" class="content-section hidden">
            <div class="section-header">
              <div class="flex-1">
                <div class="section-heading">
                  <div class="section-step-badge section-step-badge-success">
                    <i class="fi fi-rr-check icon" aria-hidden="true"></i>
                  </div>
                  <h2 class="section-title">Resultados</h2>
                </div>
                <p class="section-subtitle section-subtitle-offset">
                  Registro detallado de la ejecución y métricas obtenidas
                </p>
              </div>
              <button id="btn-clear-logs" class="btn btn-outline btn-sm">
                <i class="fi fi-rr-trash icon" aria-hidden="true"></i>
                <span>Limpiar</span>
              </button>
            </div>

            <div class="logs-wrapper mt-6">
              <div class="logs-header">
                <span
                  class="font-bold text-success-light flex items-center gap-2"
                >
                  <i class="fi fi-rr-clipboard icon" aria-hidden="true"></i>
                  <span>Terminal</span>
                </span>
                <span class="text-xs text-neutral-400">
                  GreenCircuit v2.0
                </span>
              </div>
              <div id="log-container"></div>
            </div>
          </section>
        </div>
      </main>

      <!-- FOOTER COMPACTO -->
      <footer class="app-footer app-footer--compact">
        <div>
          <p class="text-secondary mb-0 flex items-center gap-2">
            <i class="fi fi-rr-leaf icon" aria-hidden="true"></i>
            <span
              ><strong>GreenCircuit</strong> - Optimización de Rutas TSP ·
              2025</span
            >
          </p>
        </div>
      </footer>
    </div>
    <!-- Fin del app-container -->

    <div
      id="toast-stack"
      class="toast-stack"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <!-- JavaScript - Orden de carga importante (clases primero, luego app.js) -->
    <script src="src/js/Graph.js"></script>
    <script src="src/js/RandomGenerator.js"></script>
    <script src="src/js/HamiltonianFinder.js"></script>
    <script src="src/js/TSPSolver.js"></script>
    <script src="src/js/CytoscapeRenderer.js"></script>
    <script src="src/js/LogDisplay.js"></script>
    <script src="src/js/GraphEditor.js"></script>
    <script src="src/js/app.js"></script>
  </body>
</html>
