<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GreenCircuit - Optimizaci√≥n de Rutas de Recolecci√≥n</title>
    <meta name="description" content="Optimizaci√≥n de rutas de recolecci√≥n de residuos urbanos usando el Problema del Agente Viajero (TSP)">

    <!-- CSS -->
    <link rel="stylesheet" href="src/styles/main.css" />

    <!-- Cytoscape.js desde CDN -->
    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  </head>

  <body>
    <!-- CONTENEDOR PRINCIPAL DE LA APP -->
    <div class="app-container">
      
      <!-- HEADER CON WIZARD INTEGRADO -->
      <header class="app-header">
        <div class="app-logo">
          <span class="app-logo-icon">üå±</span>
          <span class="app-logo-text">GreenCircuit</span>
        </div>

        <!-- WIZARD PROGRESS EN HEADER -->
        <div class="wizard-progress-header">
          <div class="wizard-steps">
            <div class="wizard-step active" data-step="1">
              <div class="wizard-step-number">1</div>
              <div class="wizard-step-label">Configuraci√≥n</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="2">
              <div class="wizard-step-number">2</div>
              <div class="wizard-step-label">Generaci√≥n</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="3">
              <div class="wizard-step-number">3</div>
              <div class="wizard-step-label">Visualizaci√≥n</div>
            </div>
            <div class="wizard-step-line"></div>
            <div class="wizard-step" data-step="4">
              <div class="wizard-step-number">4</div>
              <div class="wizard-step-label">Ejecuci√≥n</div>
            </div>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: var(--spacing-4);">
          <a href="landing.html" class="btn btn-outline btn-sm" style="text-decoration: none;">
            ‚ÑπÔ∏è Ayuda
          </a>
          <span class="text-secondary" style="font-size: var(--font-size-sm);">Optimizaci√≥n TSP</span>
        </div>
      </header>

      <!-- MAIN CONTENT CENTRADO -->
      <!-- MAIN CONTENT CENTRADO -->
      <main class="app-main" style="display: block; overflow-y: auto;">
        <div class="container-narrow" style="padding: var(--spacing-8) var(--spacing-6);">

          <!-- SECCI√ìN 1: CONFIGURACI√ìN -->
          <section id="config-section" class="content-section animate-fade-in-up delay-200">
            <div class="section-header">
              <div>
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-2);">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: var(--font-size-xl);">1</div>
                  <h2 class="section-title" style="margin: 0;">Configuraci√≥n del Grafo</h2>
                </div>
                <p class="section-subtitle" style="margin-left: 52px;">Define el n√∫mero de puntos de recolecci√≥n para optimizar</p>
              </div>
            </div>

            <div class="card" style="margin-top: var(--spacing-6);">
              <div class="card-body">
                <div class="form-group">
                  <label for="input-n" class="form-label">
                    <strong>¬øCu√°ntos puntos de recolecci√≥n deseas optimizar?</strong>
                  </label>
                  <div style="display: flex; align-items: center; gap: var(--spacing-4);">
                    <input 
                      type="number" 
                      id="input-n" 
                      class="form-input"
                      min="8" 
                      max="16" 
                      value="10"
                      placeholder="Ej: 10"
                      style="max-width: 120px; font-size: var(--font-size-xl); font-weight: var(--font-weight-bold); text-align: center;"
                    />
                    <span class="text-secondary" style="font-size: var(--font-size-sm);">puntos (entre 8 y 16)</span>
                  </div>
                  <small class="form-helper">
                    üí° <strong>Recomendaci√≥n:</strong> Comienza con 10 puntos para una ejecuci√≥n r√°pida. Valores mayores a 12 pueden tardar varios segundos.
                  </small>
                </div>

                <button id="btn-config" class="btn btn-primary btn-lg" style="width: 100%;">
                  ‚úÖ Continuar
                </button>
              </div>
            </div>

            <div id="config-status" class="mt-4"></div>
          </section>

          <!-- SECCI√ìN 2: GENERACI√ìN (Inicialmente oculta) -->
          <section id="generation-section" class="content-section hidden">
            <div class="section-header">
              <div>
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-2);">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: var(--font-size-xl);">2</div>
                  <h2 class="section-title" style="margin: 0;">Generaci√≥n del Grafo</h2>
                </div>
                <p class="section-subtitle" style="margin-left: 52px;">Elige c√≥mo distribuir los puntos en el mapa</p>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4" style="margin-top: var(--spacing-6);">
              <button id="btn-random" class="card hover-lift" style="cursor: pointer; border: 2px solid var(--color-border-light); padding: var(--spacing-6); text-align: center; transition: all var(--transition-base);">
                <div style="font-size: var(--font-size-4xl); margin-bottom: var(--spacing-3);">üé≤</div>
                <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); margin-bottom: var(--spacing-2);">Aleatorio</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">Distribuci√≥n aleatoria con separaci√≥n m√≠nima</p>
              </button>

              <button id="btn-random-circular" class="card hover-lift" style="cursor: pointer; border: 2px solid var(--color-border-light); padding: var(--spacing-6); text-align: center; transition: all var(--transition-base);">
                <div style="font-size: var(--font-size-4xl); margin-bottom: var(--spacing-3);">‚≠ï</div>
                <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); margin-bottom: var(--spacing-2);">Circular</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">Puntos distribuidos en un c√≠rculo uniforme</p>
              </button>

              <button id="btn-random-grid" class="card hover-lift" style="cursor: pointer; border: 2px solid var(--color-border-light); padding: var(--spacing-6); text-align: center; transition: all var(--transition-base);">
                <div style="font-size: var(--font-size-4xl); margin-bottom: var(--spacing-3);">‚äû</div>
                <h3 style="font-size: var(--font-size-lg); font-weight: var(--font-weight-bold); margin-bottom: var(--spacing-2);">Grid</h3>
                <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin: 0;">Distribuci√≥n en cuadr√≠cula regular</p>
              </button>
            </div>

            <div id="generation-status" class="mt-4"></div>
          </section>

          <!-- SECCI√ìN 3: VISUALIZACI√ìN DEL GRAFO -->
          <section id="graph-section" class="content-section">
            <div class="section-header">
              <div>
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-2);">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: var(--font-size-xl);">3</div>
                  <h2 class="section-title" style="margin: 0;">Visualizaci√≥n del Grafo</h2>
                </div>
                <p class="section-subtitle" style="margin-left: 52px;">Explora y edita el grafo generado</p>
              </div>
            </div>

            <div id="graph-info" class="card card-gradient mb-4 hidden">
              <div class="card-body">
                <div id="graph-stats"></div>
              </div>
            </div>

            <div class="graph-wrapper" style="margin-top: var(--spacing-6);">
              <div id="graph-container"></div>
              
              <!-- Toolbar flotante -->
              <div class="floating-toolbar">
                <button id="btn-fit-view" class="btn btn-icon btn-ghost" title="Ajustar vista">
                  üîç
                </button>
                <button id="btn-reset-view" class="btn btn-icon btn-ghost" title="Resetear vista">
                  üîÑ
                </button>
                <div class="toolbar-divider"></div>
                <button id="btn-toggle-edit" class="btn btn-sm" style="background: var(--gradient-warning); color: white; font-weight: var(--font-weight-medium);" title="Activar modo edici√≥n">
                  ‚úèÔ∏è Editar
                </button>
                <button id="btn-clear-graph" class="btn btn-icon hidden" style="background: var(--gradient-error); color: white;" title="Limpiar grafo">
                  üóëÔ∏è
                </button>
              </div>
            </div>

            <div id="edit-mode-info" class="info-box info-box-warning mt-4 hidden">
              <strong>‚úèÔ∏è Modo Edici√≥n Activo:</strong>
              <ul style="margin: var(--spacing-2) 0 0 var(--spacing-6); line-height: var(--line-height-relaxed);">
                <li><strong>Click en el canvas</strong> ‚Üí Agregar un nodo nuevo</li>
                <li><strong>Click derecho en un nodo</strong> ‚Üí Eliminar nodo</li>
                <li><strong>L√≠mite:</strong> M√°ximo 16 nodos permitidos</li>
              </ul>
            </div>

            <button id="btn-continue-execution" class="btn btn-primary btn-lg hidden" style="width: 100%; margin-top: var(--spacing-6);">
              Continuar ‚Üí
            </button>
          </section>

          </section>

          </section>

          <!-- SECCI√ìN 4: CONTROLES DE EJECUCI√ìN (Inicialmente oculta) -->
          <section id="controls-section" class="content-section hidden">
            <div class="section-header">
              <div>
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-2);">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: var(--font-size-xl);">4</div>
                  <h2 class="section-title" style="margin: 0;">Ejecutar Algoritmo TSP</h2>
                </div>
                <p class="section-subtitle" style="margin-left: 52px;">Configura la velocidad y ejecuta la optimizaci√≥n</p>
              </div>
            </div>

            <div class="card" style="margin-top: var(--spacing-6);">
              <div class="card-body">
                <label class="form-label" style="margin-bottom: var(--spacing-4);">
                  <strong>‚ö° Velocidad de Ejecuci√≥n</strong>
                </label>
                
                <div class="speed-options" style="display: flex; gap: var(--spacing-3); margin-bottom: var(--spacing-6);">
                  <label class="speed-option">
                    <input type="radio" name="speed" value="fast" id="speed-fast" style="display: none;">
                    <div class="speed-card" data-speed="fast" id="btn-fast">
                      <div class="speed-icon">‚ö°</div>
                      <div class="speed-name">R√°pido</div>
                      <div class="speed-desc">500ms/paso</div>
                    </div>
                  </label>
                  
                  <label class="speed-option">
                    <input type="radio" name="speed" value="slow" id="speed-slow" checked style="display: none;">
                    <div class="speed-card active" data-speed="slow" id="btn-slow">
                      <div class="speed-icon">üê¢</div>
                      <div class="speed-name">Lento</div>
                      <div class="speed-desc">1s/paso</div>
                    </div>
                  </label>
                  
                  <label class="speed-option">
                    <input type="radio" name="speed" value="manual" id="speed-manual" style="display: none;">
                    <div class="speed-card" data-speed="manual" id="btn-manual-step">
                      <div class="speed-icon">üëÜ</div>
                      <div class="speed-name">Manual</div>
                      <div class="speed-desc">Click/paso</div>
                    </div>
                  </label>
                </div>

                <div class="info-box info-box-warning" style="margin-bottom: var(--spacing-6);">
                  <strong>‚ö†Ô∏è Recomendaci√≥n:</strong> Para N > 10, usa modo <strong>Lento</strong> o <strong>Manual</strong> para evitar congelamiento.
                </div>

                <div id="manual-controls" class="hidden mb-6">
                  <button id="btn-next-step" class="btn btn-outline" style="width: 100%;">
                    ‚û°Ô∏è Siguiente Paso
                  </button>
                </div>

                <button id="btn-execute" class="btn btn-xl" style="width: 100%; background: var(--gradient-success); color: white; font-weight: var(--font-weight-bold); box-shadow: var(--shadow-success);">
                  ‚ñ∂Ô∏è EJECUTAR ALGORITMO
                </button>
              </div>
            </div>

            <div id="execution-status" class="mt-4"></div>
            
            <div id="progress-container" class="hidden mt-6">
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
              </div>
              <div id="progress-text" class="progress-text">Progreso: 0%</div>
            </div>
          </section>

          <!-- SECCI√ìN 5: LOGS Y RESULTADOS (Inicialmente oculta) -->
          <section id="results-section" class="content-section hidden">
            <div class="section-header">
              <div style="flex: 1;">
                <div style="display: flex; align-items: center; gap: var(--spacing-3); margin-bottom: var(--spacing-2);">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-success); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: var(--font-size-xl);">‚úì</div>
                  <h2 class="section-title" style="margin: 0;">Resultados</h2>
                </div>
                <p class="section-subtitle" style="margin-left: 52px;">Registro detallado de la ejecuci√≥n y m√©tricas obtenidas</p>
              </div>
              <button id="btn-clear-logs" class="btn btn-outline btn-sm">
                üóëÔ∏è Limpiar
              </button>
            </div>

            <div class="logs-wrapper" style="margin-top: var(--spacing-6);">
              <div class="logs-header">
                <span style="font-weight: var(--font-weight-bold); color: var(--color-success-light);">
                  ‚óè Terminal
                </span>
                <span style="font-size: var(--font-size-xs); color: var(--color-neutral-400);">
                  GreenCircuit v2.0
                </span>
              </div>
              <div id="log-container"></div>
            </div>
          </section>

        </div>
      </main>

      <!-- FOOTER COMPACTO -->
      <footer class="app-footer" style="padding: var(--spacing-4); font-size: var(--font-size-sm);">
        <div style="text-align: center;">
          <p style="margin: 0; color: var(--color-text-secondary);">
            üå± <strong style="color: var(--color-primary-600);">GreenCircuit</strong> - Optimizaci√≥n de Rutas TSP ¬∑ 2025
          </p>
        </div>
      </footer>

    </div>
    <!-- Fin del app-container -->

    <!-- JavaScript - Orden de carga importante (clases primero, luego app.js) -->
    <script src="src/js/Graph.js"></script>
    <script src="src/js/RandomGenerator.js"></script>
    <script src="src/js/HamiltonianFinder.js"></script>
    <script src="src/js/TSPSolver.js"></script>
    <script src="src/js/CytoscapeRenderer.js"></script>
    <script src="src/js/LogDisplay.js"></script>
    <script src="src/js/GraphEditor.js"></script>
    <script src="src/js/app.js"></script>
  </body>
</html>
